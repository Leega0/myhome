function status(e){statusline.innerHTML=e}function save(){if(idletimer&&clearTimeout(idletimer),idletimer=null,navigator.onLine){var e=new XMLHttpRequest;e.open("PUT","/note"),e.send(editor.value),e.onload=function(){localStorage.lastSaved=Date.now(),savebutton.disabled=!0}}}function sync(){if(navigator.onLine){var e=new XMLHttpRequest;e.open("GET","/note"),e.send(),e.onload=function(){var t=0;if(200==e.status){var t=e.getResponseHeader("Last-Modified");t=new Date(t).getTime()}if(t>localStorage.lastModified){status("Newer note found on server.");var o=confirm("This is a newer version of the note\non the server. Click Ok to use that version\nor click Cancel to continue editing this\nversion and overwrite the server"),n=Date.now();o?(editor.value=localStorage.note=e.responseText,localStorage.lastSaved=n,status("Newest version downloaded.")):status("Ignoring newer version of the note."),localStorage.lastModified=n}else status("You are editing the current version of the note.");localStorage.lastModified>localStorage.lastSaved&&save(),editor.disabled=!1,editor.focus()}}else status("Can't sync while offline"),editor.disabled=!1,editor.focus()}var editor,statusline,savebutton,idletimer;window.onload=function(){null==localStorage.note&&(localStorage.note=""),(localStorage.lastModified=null)&&(localStorage.lastModified=0),null==localStorage.lastSaved&&(localStorage.lastSaved=0),editor=document.getElementById("editor"),statusline=document.getElementById("statusline"),savebutton=document.getElementById("savebutton"),editor.value=localStorage.note,editor.disabled=!0,editor.addEventListener("input",function(e){localStorage.note=editor.value,localStorage.lastModified=Date.now(),idletimer&&clearTimeout(idletimer),idletimer=setTimeout(save,5e3),savebutton.disabled=!1},!1),sync()},window.onbeforeunload=function(){localStorage.lastModified>localStorage.lastSaved&&save()},window.onoffline=function(){status("Offline")},window.ononline=function(){sync()},window.applicationCache.onupdateready=function(){status("A new version of this application is available,Reload to run it")},window.applicationCache.onnoupdate=function(){status("You are running the latest version of the application.")};